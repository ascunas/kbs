<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>출장신청</title>

    <script src="../../js/jquery-1.8.0.min.js"></script>
    <script src="../../js/bootstrap-datepicker.min.js"></script>
    <script src="../../js/bootstrap-datepicker.ko.min.js"></script>
    <script src="../../js/common_new.js"></script>
    <script src="../../js/cap.js"></script>

    <link rel="stylesheet" href="../../css/cap.css">
    <link rel="stylesheet" href="../../css/bootstrap-datepicker.css" />
    <link rel="stylesheet" href="../../css/style_new.css">

    <script>
    jQuery(function ($) {

        //페이지 로더 제어
        if (typeof Loader !== 'undefined') {
            Loader.start();
            setTimeout(function() {
                Loader.complete();
                console.log("로딩 완료 테스트");
            }, 1000);
        }


        // 검색 조건 전환 (Select 박스 기준)
        $(document).on('change', '.fn-search-select', function() {
            var $select = $(this);
            var val = $select.val();
            var $container = $select.closest('.fn-search-field'); 
            
            var $targets = $container.find('.fn-search-target');
            $targets.hide();
            $targets.filter('[data-view="' + val + '"]').show();
        });


        //비용집계대상 전환 (Radio 버튼 기준)
        function refreshCostTarget() {
            var $checked = $('input[name="cost-type"]').filter(':checked');
            if (!$checked.length) return;

            var targetVal = $checked.val();
            var $container = $checked.closest('.form-row');

            $container.find('.fn-modal-open').hide();
            $container.find('.fn-modal-open[data-target="' + targetVal + '"]').show();
        }

        $(document).on('change', 'input[name="cost-type"]', function() {
            refreshCostTarget();
        });


        // 운전여비지급 체크박스 토글 (공통)
        function handleCheckToggle($trigger) {
            var targetName = $trigger.attr('data-target-name');
            var $parent = $trigger.closest('.form-group, .form-row');
            var $target = $parent.find('.fn-check-target[data-target-name="' + targetName + '"]');

            if ($trigger.is(':checked')) {
                $target.show();
            } else {
                $target.hide();
            }
        }

        $(document).on('change', '.fn-check-trigger', function() {
            handleCheckToggle($(this));
        });

        /**
         * [5] 초기 로드 시 상태 동기화 (Init)
         */
        function initUI() {
            // select box검색 조건 초기화
            $('.fn-search-select').trigger('change');
            
            // 비용 코드 버튼 초기화
            refreshCostTarget();
            
            // 운전여비지급 체크박스 토글 초기화
            $('.fn-check-trigger').each(function() {
                handleCheckToggle($(this));
            });
        }

        // 모든 정의가 끝난 후 초기화 실행
        initUI();
    });
    </script>
</head>
<body class="sub-page">
    
    <div class="app-shell">
        <header class="app-header">
            <button class="icon-button prev" type="button" aria-label="이전 페이지로 이동"></button>
            <h1 class="title">출장신청</h1>
            <button class="icon-button menu" type="button" aria-label="전체 메뉴 열기" aria-haspopup="true" aria-expanded="false" aria-controls="main-menu" data-menu-toggle></button>
        </header>

        <main class="content fn-height form-content">
            <form class="apply-form" action="#" method="post">
                <div class="form-row">
                    <label class="form-label" for="trip-group">출장유형</label>
                    <div class="input-wrap select">
                        <select id="trip-group" name="trip-group" aria-label="출장유형 선택">
                            <option value="">선택하세요</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <label class="form-label" for="trip-cate">출장구분</label>
                    <div class="input-wrap select">
                        <select id="trip-cate" name="trip-cate" aria-label="출장구분 선택">
                            <option value="">선택하세요</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <label class="form-label">기간</label>
                    <div class="date-row">
                        <div class="input-wrap date">
                            <input type="text" name="start-date" class="datepicker" aria-label="시작일" placeholder="YYYY.MM.DD" readonly="readonly">
                        </div>
                        <span class="date-tilde" aria-hidden="true">~</span>
                        <div class="input-wrap date">
                            <input type="text" name="end-date" class="datepicker" aria-label="종료일" placeholder="YYYY.MM.DD" readonly="readonly">
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <label class="form-label" for="trip-place">출장지</label>
                    <div class="input-wrap input">
                        <input type="text" id="trip-place" placeholder="출장지를 입력하세요">
                    </div>
                </div>

                <div class="form-row">
                    <label class="form-label" for="trip-content">출장내용</label>
                    <div class="input-wrap input">
                        <textarea id="trip-content" placeholder="출장내용을 입력하세요"></textarea>
                    </div>
                </div>

                <div class="form-row divider">
                    <label class="form-label">비용집계대상</label>
                    <div class="input-wrap group">
                        <div class="pill-radio-group" role="radiogroup" aria-label="비용집계대상 선택">
                            <label class="pill-radio">
                                <input type="radio" name="cost-type" value="costCodeModal" checked>
                                <span class="pill-radio-label">비용(WBS)</span>
                            </label>
                            <label class="pill-radio">
                                <input type="radio" name="cost-type" value="capitalCodeModal">
                                <span class="pill-radio-label">자본</span>
                            </label>
                        </div>
                        <div class="search-input-group">
                            <div class="input-wrap">
                                <input id="cost-code-input" type="text" name="code" aria-label="선택된 비용 코드" placeholder="코드를 검색하세요" readonly>
                            </div>
                            <button class="icon-button search fn-modal-open" type="button" aria-label="비용 코드 검색 창 열기" data-target="costCodeModal"></button>
                            <button class="icon-button search fn-modal-open" type="button" aria-label="자본 코드 검색 창 열기" data-target="capitalCodeModal"></button>
                        </div>
                        <span class="text result">코드명 : <em><span class="blind">선택된 코드 번호:</span>00348568</em></span>
                    </div>
                </div>

                <div class="form-row divider">
                    <label class="form-label">관련사항
                        <button class="icon-button sm info fn-modal-open" type="button" aria-label="관련사항 안내" aria-haspopup="dialog" data-target="infoModal"></button>
                    </label>

                    <div class="pill-check-group" role="group" aria-label="출장 유형 다중 선택">
                        <label class="pill-check">
                            <input type="checkbox" name="trip-type" checked>
                            <span class="pill-check-label">자기차량이용</span>
                        </label>
                        <label class="pill-check">
                            <input type="checkbox" name="trip-type">
                            <span class="pill-check-label">집행기관수행</span>
                        </label>
                        <label class="pill-check">
                            <input type="checkbox" name="trip-type">
                            <span class="pill-check-label">공사차량이용</span>
                        </label>
                        <label class="pill-check">
                            <input type="checkbox" name="trip-type">
                            <span class="pill-check-label">이동숙박</span>
                        </label>
                        <div class="form-group pill-check">
                            <label class="pill-check if-check">
                                <input type="checkbox" name="trip-type" class="fn-check-trigger" data-target-name="travel-expenses">
                                <span class="pill-check-label">운전여비지급</span>
                            </label>                        
                            <div class="input-wrap select fn-check-target" data-target-name="travel-expenses" style="display: none;">
                                <select id="allowance" name="allowance" aria-label="운전여비지급 상세선택">
                                    <option value="">선택하세요</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-row divider">
                    <label class="form-label">교통비<br>기타비용 가감</label>
                    <div class="input-wrap group">
                        <div class="input-wrap flex-end">
                            <span class="text result">합계 : <em>45,000원</em></span>
                            <button class="icon-button add fn-add" type="button" data-row-target="#other-costs-rows" aria-label="기타비용 추가"></button>
                        </div>
                        
                        <div class="form-row wrap fn-row" id="other-costs-rows" style="display: none;">
                            <div class="form-row-item">
                                <div class="cost-row">
                                    <span class="form-label">항목</span>
                                    <div class="input-wrap">
                                        <input id="" type="text" name="" aria-label="비용 항목" placeholder="항목을 입력하세요">
                                    </div>
                                    <span class="form-label">금액</span>
                                    <div class="input-wrap">
                                        <input id="" type="text" name="" aria-label="비용 금액" placeholder="금액을 입력하세요">
                                    </div>
                                </div>
                                <button class="icon-button remove fn-remove" type="button" aria-label="기타비용 삭제"></button>                            
                            </div>
                        </div>
                        <div class="form-row divider">
                            <span class="form-label">합계</span>
                            <div class="input-wrap">
                                <span class="text result">45,000원</span>
                            </div>
                        </div>
                    </div>
                    
                </div>

                <div class="form-row divider">
                    <label class="form-label">결재자</label>
                    <button class="icon-button add fn-modal-open" type="button" aria-label="결재자 추가" data-target="approverModal"></button>
                </div>
                
                <div class="form-row approver-row">
                    <div class="approver-search">
                        
                        <div class="approver-form-wrap">
                            <div class="grid-row row-1">
                                <div class="input-wrap select">
                                    <select aria-label="결재타입 선택">
                                        <option value="">입력/상신</option>
                                    </select>
                                </div>
                                <div class="input-wrap">
                                    <input id="submit" type="text" name="submit" aria-label="상신자" value="정광본" readonly="readonly">
                                </div>
                            </div>

                            <div class="grid-row row-2 fn-row">                                
                                <div class="input-wrap select">
                                    <select aria-label="결재타입 선택">
                                        <option value="">선택하세요</option>
                                        <option value="">결재</option>
                                    </select>
                                </div>
                                <div class="input-wrap">
                                    <input id="approver" type="text" name="approver" aria-label="결재자" placeholder="결재자를 선택하세요" value="나구열 팀장" readonly="readonly">
                                </div>
                                <button class="icon-button search fn-modal-open" type="button" aria-label="결재자 검색" data-target="approverModal"></button>
                                <button class="icon-button add fn-add" type="button" aria-label="결재자 삭제"></button>
                            </div>
                            <div class="grid-row row-2 fn-row">                                
                                <div class="input-wrap select">
                                    <select aria-label="결재타입 선택">
                                        <option value="">결재</option>
                                    </select>
                                </div>
                                <div class="input-wrap">
                                    <input id="approver" type="text" name="approver" aria-label="결재자" value="나구열 팀장" readonly="readonly">
                                </div>
                                <button class="icon-button search fn-modal-open" type="button" aria-label="결재자 검색" data-target="approverModal"></button>
                                <button class="icon-button remove fn-remove" type="button" aria-label="결재자 삭제"></button>
                            </div>
                        </div>
                        <p class="help-text">최근 결재자가 기본으로 표시됩니다.</p>
                    </div>
                </div>

                

            </form>
        </main>

        <div class="footer-action" role="group" aria-label="하단 액션 메뉴">
            <button class="action-button global" type="button">결재상신</button>
            <button class="action-button primary" type="button">저장</button>
        </div>

        <aside class="menu-panel" id="main-menu" aria-label="전체 메뉴" role="dialog" aria-modal="true" aria-hidden="true">
            <div class="menu-hero">
                <div class="menu-hero-content">
                    <p class="menu-subtitle">ESS Mobile</p>
                </div>
                <button class="menu-close" type="button" aria-label="메뉴 닫기" data-menu-close></button>
            </div>
            <nav class="menu-body">
                <ul class="menu-list">
                    <li>
                        <a class="menu-item home" href="#">
                            <span class="menu-label">Home</span>
                        </a>
                    </li>
                    <li>
                        <a class="menu-item atten active" href="#" aria-current="page">
                            <span class="menu-label">근태 내역</span>
                        </a>
                    </li>
                    <li>
                        <a class="menu-item trip" href="#">
                            <span class="menu-label">출장 내역</span>
                        </a>
                    </li>
                    <li>
                        <a class="menu-item overtime" href="#">
                            <span class="menu-label">시간외 근무내역</span>
                        </a>
                        <ul class="menu-children">
                            <li><a class="menu-item" href="#">시간외 신청</a></li>
                            <li><a class="menu-item" href="#">선택근로 실적 입력</a></li>
                        </ul>
                    </li>
                    <li>
                        <a class="menu-item event" href="#">
                            <span class="menu-label">경조금</span>
                        </a>
                    </li>
                    <li>
                        <a class="menu-item faq" href="#">
                            <span class="menu-label">복무관리 FAQ</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

    </div>

    <div id="costCodeModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="costCodeModalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="costCodeModalTitle">비용(WBS) 코드 조회</h2>
                <button class="modal-close fn-modal-close" type="button" aria-label="모달 닫기"></button>
            </div>
            <div class="modal-body">
                <div class="search-field fn-search-field">
                    
                    <div class="search-input-group">
                        <label class="form-label" for="search-category-cost">검색구분</label>
                        <div class="input-wrap select">
                            <select id="search-category-cost" class="fn-search-select" aria-label="검색구분" autofocus>
                                <option value="category-dept">1.세분류사업명-부서로 검색</option>
                                <option  value="category-project">2.세분류사업명-이름으로 검색</option>
                                <option value="category-program">3.프로그램명 검색</option>
                            </select>
                        </div>
                    </div>

                    <div class="search-input-group fn-search-target" data-view="category-dept">
                        <label class="form-label" for="dept">부서검색</label>
                        <div class="input-wrap">
                            <input id="dept" type="text" aria-label="부서" placeholder="부서를 검색하세요" readonly>
                        </div>
                        <button class="icon-button search fn-modal-open" type="button" aria-label="부서 검색" data-target="deptModal"></button>
                    </div>

                    <div class="search-input-group fn-search-target" data-view="category-project">
                        <label class="form-label" for="project">세분류사업명</label>
                        <div class="input-wrap">
                            <input id="project" type="text" ria-label="세분류사업명" placeholder="세분류사업명을 입력하세요">
                        </div>
                    </div>

                    <div class="input-wrap group fn-search-target" data-view="category-program">
                        <div class="search-input-group">
                            <label class="form-label">방송(예정)일</label>
                            <div class="input-wrap">
                                <div class="input-wrap date">
                                    <input type="text" name="start-date" class="datepicker" aria-label="시작일" placeholder="YYYY.MM.DD" readonly="readonly">
                                </div>
                                <span class="date-tilde" aria-hidden="true">~</span>
                                <div class="input-wrap date">
                                    <input type="text" name="end-date" class="datepicker" aria-label="종료일" placeholder="YYYY.MM.DD" readonly="readonly">
                                </div>
                            </div>
                        </div>
                        <div class="search-input-group">
                            <label class="form-label" for="program">프로그램명</label>
                            <div class="input-wrap">
                                <input id="program" type="text" aria-label="프로그램명" placeholder="프로그램명을 입력하세요">
                            </div>
                        </div>
                    </div>

                    <button class="button search" type="button" aria-label="조회">조회</button>
                </div>

                <p class="note">총 3건이 검색되었습니다.</p>
                <ul class="search-result flex-colum">
                    <li>
                        <a href="javascript:void(0)" class="search-result-item fn-modal-close">
                            <span class="number">000037463269</span>
                            <span class="name">모바일코비스개선 / IT개발운영팀</span>
                        </a>
                    </li>
                    <li>
                        <a href="javascript:void(0)" class="search-result-item fn-modal-close">
                            <span class="number">000037463269</span>
                            <span class="name">SW개발비 / 2024편성제작정보시스템기능개선사업 IT개발운영팀</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div id="capitalCodeModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="capitalCodeModalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="capitalCodeModalTitle">자본예산 코드 조회</h2>
                <button class="modal-close fn-modal-close" type="button" aria-label="모달 닫기"></button>
            </div>
            <div class="modal-body">
                <div class="search-field fn-search-field">
                    
                    <div class="search-input-group">
                        <label class="form-label" for="search-category-capital">검색구분</label>
                        <div class="input-wrap select">
                            <select id="search-category-capital" class="fn-search-select" aria-label="검색구분" autofocus>
                                <option value="category-dept">1.자산-부서로 검색</option>
                                <option value="category-asset">2.자산-자산명으로 검색</option>
                            </select>
                        </div>
                    </div>

                    <div class="search-input-group fn-search-target" data-view="category-dept">
                        <label class="form-label" for="dept">부서검색</label>
                        <div class="input-wrap">
                            <input id="dept" type="text" aria-label="부서" placeholder="부서를 검색하세요" readonly>
                        </div>
                        <button class="icon-button search fn-modal-open" type="button" aria-label="부서 검색" data-target="deptModal"></button>
                    </div>

                    <div class="search-input-group fn-search-target" data-view="category-asset">
                        <label class="form-label" for="asset">자산명</label>
                        <div class="input-wrap">
                            <input id="asset" type="text" aria-label="자산명" placeholder="자산명을 입력하세요">
                        </div>
                    </div>

                    <button class="button search" type="button" aria-label="조회">조회</button>
                </div>

                <p class="note">총 3건이 검색되었습니다.</p>
                <ul class="search-result flex-colum">
                    <li>
                        <a href="javascript:void(0)" class="search-result-item fn-modal-close">
                            <span class="number">000037463269</span>
                            <span class="name">모바일코비스개선 / IT개발운영팀</span>
                        </a>
                    </li>
                    <li>
                        <a href="javascript:void(0)" class="search-result-item fn-modal-close">
                            <span class="number">000037463269</span>
                            <span class="name">SW개발비 / 2024편성제작정보시스템기능개선사업 IT개발운영팀</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div id="infoModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="infoModalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="infoModalTitle">관련사항 안내</h2>
                <button class="modal-close fn-modal-close" type="button" aria-label="모달 닫기"></button>
            </div>
            <div class="modal-body">
                <div class="info-list-wrap">
                    <dl class="info-list-item">
                        <dt>지근거리 출장</dt>
                        <dd>(왕복 2km이내) 관내출장에 따른 여비(일비, 식비, 숙박비 등)을 지급하지 않음 (단, 실비 정산 가능)</dd>
                    </dl>
                    <dl class="info-list-item">
                        <dt>자기차량이용</dt>
                        <dd>(왕복 2km이내) 관내출장에 따른 여비(일비, 식비, 숙박비 등)을 지급하지 않음</dd>
                    </dl>
                    <dl class="info-list-item">
                        <dt>집행기관 수행</dt>
                        <dd>(왕복 2km이내) 관내출장에 따른 여비(일비, 식비, 숙박비 등)을 지급하지 않음</dd>
                    </dl>
                    <dl class="info-list-item">
                        <dt>공사차량 이용</dt>
                        <dd>(왕복 2km이내) 관내출장에 따른 여비(일비, 식비, 숙박비 등)을 지급하지 않음</dd>
                    </dl>
                    <dl class="info-list-item">
                        <dt>이동숙박</dt>
                        <dd>(왕복 2km이내) 관내출장에 따른 여비(일비, 식비, 숙박비 등)을 지급하지 않음</dd>
                    </dl>
                    <dl class="info-list-item">
                        <dt>운전여비 지급</dt>
                        <dd>(왕복 2km이내) 관내출장에 따른 여비(일비, 식비, 숙박비 등)을 지급하지 않음</dd>
                    </dl>
                    <p class="info-text">전체일수가 아닌 특정일수 만큼 위의 내용이 적용되는 경우 기타비용으로 가감 (예, 5일 중 3일만 이동숙박)</p>
                </div>
            </div>
        </div>
    </div>
        

    <div id="approverModal" class="modal approver-modal" role="dialog" aria-modal="true" aria-labelledby="approverModalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="approverModalTitle">결재자 조회</h2>
                <button class="modal-close fn-modal-close" type="button" aria-label="결재자 조회 팝업 닫기"></button>
            </div>
            <div class="modal-body">
                <div class="search-field">
                    <div class="search-input-group">
                        <div class="input-wrap">
                            <label for="approver-search" class="blind">검색할 결재자 이름</label>
                            <input id="approver-search" type="text" placeholder="이름으로 검색하세요" autofocus>
                        </div>
                        <button class="icon-button search" type="button" aria-label="검색 실행"></button>
                    </div>
                </div>
                <p class="note" aria-live="polite">총 3건이 검색되었습니다.</p>
                <ul class="search-result">
                    <li>
                        <a href="#" class="search-result-item fn-modal-close" aria-label="나구열 팀장 선택">
                            <span class="number">0987654</span>
                            <span class="name">나구열 팀장</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="search-result-item fn-modal-close" aria-label="홍길동 차장 선택">
                            <span class="number">0987654</span>
                            <span class="name">홍길동 차장</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="search-result-item fn-modal-close" aria-label="이민수 과장 선택">
                            <span class="number">0987654</span>
                            <span class="name">이민수 과장</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div id="deptModal" class="modal approver-modal" role="dialog" aria-modal="true" aria-labelledby="deptModalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="deptModalTitle">부서 조회</h2>
                <button class="modal-close fn-modal-close" type="button" aria-label="모달 닫기"></button>
            </div>
            <div class="modal-body">
                <div class="search-field">
                    <div class="search-input-group">
                        <div class="input-wrap">
                            <input type="text" name="dept" aria-label="부서" placeholder="부서명을 검색하세요" autofocus>
                        </div>
                        <button class="icon-button search" type="button" aria-label="부서 검색"></button>
                    </div>
                </div>
                <p class="note">총 3건이 검색되었습니다.</p>
                <ul class="search-result">
                    <li>
                        <a href="javascript:void(0)" class="search-result-item fn-modal-close">
                            <span class="number">0987654</span>
                            <span class="name">경영정보부</span>
                        </a>
                    </li>
                    <li>
                        <a href="javascript:void(0)" class="search-result-item fn-modal-close">
                            <span class="number">0987654</span>
                            <span class="name">홍길동 차장</span>
                        </a>
                    </li>
                    <li>
                        <a href="javascript:void(0)" class="search-result-item fn-modal-close">
                            <span class="number">0987654</span>
                            <span class="name">이민수 과장</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>